<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>flaské¡¹ç›®å•å…ƒæµ‹è¯•å®è·µ | Pegasus&#39; Blog</title>
  <meta name="author" content="PegasusWang">
  
  <meta name="description" content="PegasusWang çš„æ—¥å¸¸è®°å½•">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="flaské¡¹ç›®å•å…ƒæµ‹è¯•å®è·µ"/>
  <meta property="og:site_name" content="Pegasus&#39; Blog"/>

  
    <meta property="og:image" content=""/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Pegasus&#39; Blog" type="application/atom+xml">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" href="/css/style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>
  <header id="header" class='normal_mode'>
    <nav id="main-nav">
  <ul class='container'>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about">About</a></li>
    
      <li><a href="https://github.com/pegasuswang/vim-config">Neovim</a></li>
    
      <li><a href="https://www.zhihu.com/people/pegasus-wang/activities">çŸ¥ä¹</a></li>
    
      <li><a href="http://python-web-guide.readthedocs.io/zh/latest/">Pythonå…¥å‘æŒ‡å—</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
  </header>
  <div id="content" class="container">
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2016-11-22T10:23:13.000Z"><a href="/2016/11/22/python/flask-unittest/">å‘¨äºŒ, 11æœˆ 22 2016, 6:23:13 æ™šä¸Š</a></time>

  
    <h1 class="title">flaské¡¹ç›®å•å…ƒæµ‹è¯•å®è·µ</h1>
  



<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <blockquote>
<p>Test early. Test often. Test automatically. Tests that run with every build are much more effective than test plans that sit on a shelf.</p>
</blockquote>
<p>æœ€è¿‘å¼€å§‹åšå…¬å¸å†…éƒ¨é¡¹ç›®ï¼ŒCRMç³»ç»Ÿï¼ˆå®¢æˆ·å…³ç³»ç®¡ç†ï¼‰ï¼Œ ç”¨çš„flask+python3.5.2ã€‚æˆ‘ä»¥å‰é—²ç€æ²¡äº‹é€›é€›githubçš„æ—¶å€™å‘ç°äº†è¿™ä¸ª<a href="https://github.com/sloria/cookiecutter-flask" target="_blank" rel="noopener">cookiecutter-flask</a>ï¼Œå°±æ˜¯ç”¨æ¥ç”Ÿæˆä¸€ä¸ªé¡¹ç›®æ¨¡æ¿çš„ä¸œè¥¿ï¼Œç›´æ¥å¸®ä½ ç”Ÿæˆé¡¹ç›®æ€»ä½“æ¡†æ¶è¿˜æœ‰READMEæ–‡ä»¶ï¼Œè¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ï¼Œç›´æ¥å¡«å†™é€»è¾‘å³å¯ã€‚ä»¥å‰å¹¶æ²¡æœ‰ä½¿ç”¨flaskçš„ç»éªŒï¼Œè¿™æ¬¡ä¹Ÿæ˜¯è¾¹æ‘¸ç´¢ä¸€è¾¹ä½¿ç”¨ï¼ˆå¥½åœ¨æ²¡ç¢°åˆ°å‘ï¼‰ï¼Œä¸»è¦æƒ³è®°å½•ä¸‹å…³äºå•å…ƒæµ‹è¯•çš„ä¸œè¥¿ã€‚crmä¸»è¦æ˜¯crudæ“ä½œï¼Œè¿™æ¬¡æˆ‘æ¯”è¾ƒé‡è§†æµ‹è¯•ä»£ç ç¼–å†™ï¼Œwebé¡¹ç›®å•å…ƒæµ‹è¯•éœ€è¦å¤„ç†æ•°æ®åº“äº¤äº’ï¼Œæ¨¡æ‹Ÿè¯·æ±‚ï¼Œæ¨¡æ‹Ÿç™»å½•ï¼Œè¡¨å•æäº¤ç­‰æ“ä½œï¼Œå¦‚ä½•ç¼–å†™æ˜“äºæ„å»ºå’Œæ‰§è¡Œçš„å•å…ƒæµ‹è¯•ä¹Ÿæ˜¯éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚æ–°é¡¹ç›®ç»Ÿä¸€ç”¨flask+python3.5.2(python3åº“çš„æ”¯æŒæ¯”æˆ‘æƒ³è±¡ä¸­å¿«ï¼Œç›®å‰ä½¿ç”¨çš„ä¾èµ–ä¸­éƒ½æ”¯æŒpython3)ï¼Œå‰ç«¯ä½¿ç”¨vueï¼Œå‰ååˆ†ç¦»ï¼Œåç«¯ä½¿ç”¨flask-restfulå†™æ¥å£ã€‚è´´å‡ºæ¥ä¸€äº›ä»£ç ï¼Œå¦‚æœå†™å¾—ä¸åˆé€‚çš„æ­£å¥½å¯ä»¥ç»™æˆ‘æŒ‡æ­£ä¸‹:)</p>
<a id="more"></a>
<hr>
<h2 id="å•å…ƒæµ‹è¯•çš„å¿…è¦æ€§"><a href="#å•å…ƒæµ‹è¯•çš„å¿…è¦æ€§" class="headerlink" title="å•å…ƒæµ‹è¯•çš„å¿…è¦æ€§"></a>å•å…ƒæµ‹è¯•çš„å¿…è¦æ€§</h2><p>ä¹‹å‰æ›¾ç»å†™è¿‡ä¸€ç¯‡è®²å•å…ƒæµ‹è¯•çš„ï¼Œæ­£å¥½æœ€è¿‘ä¹Ÿåœ¨å®è·µå’Œæ‘¸ç´¢ã€‚æˆ‘ä¼¼ä¹æœ‰ç§æ´ç™–ï¼Œå°±æ˜¯æˆ‘ä¼šä¸¥æ ¼éµå®ˆæµç¨‹æ€§çš„ä¸œè¥¿ï¼Œæ¯”å¦‚æµ‹è¯•,æ³¨é‡Šå’Œæ–‡æ¡£ç­‰ã€‚ç›®å‰å°±èŒçš„å…¬å¸åœ¨æˆ‘æ¥æ‰‹é¡¹ç›®çš„æ—¶å€™æ˜¯æ²¡æœ‰ä¸€è¡Œå•å…ƒæµ‹è¯•çš„ï¼Œæˆ‘æŒºè¯§å¼‚çš„ã€‚æˆ‘å¤§æ¦‚ä¹Ÿèƒ½ä¼°è®¡åˆ°ç›®å‰å›½å†…çš„pythoné¡¹ç›®å›¢é˜Ÿå¾ˆå¤šæ˜¯ä¸å¤ªè§„èŒƒçš„ï¼ˆæ¯”å¦‚æ²¡æœ‰å•å…ƒæµ‹è¯•ã€ä»£ç ä¸ç¬¦åˆè§„èŒƒã€æ²¡æœ‰æŒç»­ç»§æ‰¿ç­‰ï¼‰ã€‚å½“ç„¶æµç¨‹ä¸å¤Ÿè§„èŒƒå¯èƒ½ä¸ä¼šæœ‰ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æ˜¯ç»å¯¹ä¼šç»™ä»£ç ç»´æŠ¤é€ æˆå›°éš¾ï¼Œæˆ‘æ˜¯è¸©äº†å‘çš„ï¼Œæ‰€ä»¥è¦ä¿æŒè°¨æ…ã€‚è™½ç„¶è¿™æ¬¡å·¥æœŸæ¯”è¾ƒç´§ï¼ŒåŠä¸ªæœˆå†…æå‡ºæ¥ä¸€ä¸ªCRMç³»ç»Ÿï¼Œä½†æ˜¯ç›®å‰è¿™ä¸€å‘¨å¤šçš„è¿›åº¦è¿˜æ˜¯ä¸¥æ ¼éµå®ˆäº†è§„èŒƒå¹¶å®Œå–„äº†æµ‹è¯•ï¼Œå¹¶ä¸”è¿›å±•è¿˜æ˜¯æŒºé¡ºåˆ©çš„ï¼Œæ„Ÿè§‰å•å…ƒæµ‹è¯•ç¡®å®èƒ½å‡å°‘bugå‡ºç°ç‡ã€‚è‡³äºä¼šä¸ä¼šæµªè´¹å¼€å‘å’Œç»´æŠ¤æ—¶é—´ï¼Œè¿˜éœ€è¦è‡ªå·±æƒè¡¡ã€‚è‡³å°‘å‰ç«¯ä¸ç”¨é¢‘ç¹æŠ±æ€¨æ¥å£æ€ä¹ˆåˆ500å•¦ã€‚</p>
<hr>
<h2 id="å†™å•å…ƒæµ‹è¯•ä¼šé™ä½ç”Ÿäº§åŠ›å—"><a href="#å†™å•å…ƒæµ‹è¯•ä¼šé™ä½ç”Ÿäº§åŠ›å—" class="headerlink" title="å†™å•å…ƒæµ‹è¯•ä¼šé™ä½ç”Ÿäº§åŠ›å—?"></a>å†™å•å…ƒæµ‹è¯•ä¼šé™ä½ç”Ÿäº§åŠ›å—?</h2><p>å¯èƒ½æœ‰äº›äººä¸å†™å•å…ƒæµ‹è¯•æœ‰ä¸ªé‡è¦çš„ç†ç”±å°±æ˜¯ä¼šå»¶è¯¯å·¥æœŸã€‚å½“ç„¶ä½ è¦æ˜¯é—®æˆ‘ç©¶ç«Ÿä¼šä¸ä¼šé™ä½ç”Ÿäº§åŠ›ï¼Œæˆ‘åªèƒ½æ‚²å‰§æ»´è¯´æˆ‘ä¸çŸ¥é“ã€‚å…¬å¸æ°¸è¿œä¸ä¼šç»™ä½ æ—¶é—´è®©ä½ åœ¨ä¸¤ç§å¼€å‘æ–¹å¼ä¸Šå®éªŒï¼Œæ‰€ä»¥å¾ˆéš¾è¡¡é‡(ç®—ä¸Šå¼€å‘ã€ä¿®æ”¹bugå’Œç»´æŠ¤ç­‰çš„æ—¶é—´)ã€‚ä¸è¿‡ä»æˆ‘è¿™æ¬¡åšé¡¹ç›®çš„ç»éªŒä¸Šæ¥çœ‹ï¼Œè‡³å°‘ä¸ä¼šè€—è´¹å¤ªå¤šæ—¶é—´ï¼Œè€Œå•å…ƒæµ‹è¯•çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼šå‡å°‘bugï¼Œä¿è¯é‡æ„ä¸ä¼šç ´åä»£ç ï¼Œç®€æ´çš„è®¾è®¡ç­‰ã€‚ç›®å‰å‡ ä¹å›½å†…æ‰€æœ‰pythonå·¥ç¨‹å¸ˆéƒ½æ˜¯è‡ªå­¦æˆæ‰ï¼Œå­¦ä¹ èƒ½åŠ›æ˜¯æœ‰ä¿è¯çš„ï¼Œä¸è¿‡èŒä¸šç´ å…»å°±éš¾è¯´äº†ã€‚å†™ä»£ç æœ‰æ—¶å€™å¹¶ä¸éš¾ï¼Œä½†æ˜¯ç»´æŠ¤æˆæœ¬å´å¾ˆé«˜ã€‚æˆ‘è§‰å¾—å†™å•å…ƒæµ‹è¯•å’Œä½ å†™æ³¨é‡Šä¸€æ ·ï¼Œä»€ä¹ˆæ—¶å€™å†™ï¼Œå†™ä»€ä¹ˆéƒ½éœ€è¦æœ‰è‰¯å¥½çš„åˆ¤æ–­åŠ›ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯è´¨é‡ï¼Œè€Œä¸æ˜¯æ•°é‡ã€‚æˆ‘åˆšå­¦pythonçš„æ—¶å€™å°±æ˜¯ä¹ æƒ¯å†™ä¸ªå‡½æ•°ï¼Œprintä¸‹çœ‹çœ‹ç»“æœï¼Œè§‰å¾—æ²¡é”™å°±è®¤ä¸ºå¯ä»¥å·¥ä½œäº†ï¼Œç°åœ¨çš„ä¹ æƒ¯å°±æ˜¯æŠŠæœŸæœ›ç»“æœå†™åœ¨å•å…ƒæµ‹è¯•é‡Œå¤´ï¼Œç”¨assertåˆ¤æ–­æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚å½“ç„¶ï¼Œæœ€é‡è¦çš„è¿˜æ˜¯å°½é‡ç¼–å†™æ¸…æ™°æ˜“æ‡‚çš„ä»£ç ã€‚</p>
<hr>
<h2 id="flaskå•å…ƒæµ‹è¯•"><a href="#flaskå•å…ƒæµ‹è¯•" class="headerlink" title="flaskå•å…ƒæµ‹è¯•"></a>flaskå•å…ƒæµ‹è¯•</h2><p>ç”±äºæˆ‘ç›´æ¥å·æ‡’ä½¿ç”¨äº†[cookiecutter-flask]ç”Ÿæˆæ¡†æ¶ï¼Œè‡ªå¸¦äº†ä¸€ä¸ªtestsæ–‡ä»¶å¤¹ï¼Œæˆ‘å°±ç›´æ¥ç…§è‘«èŠ¦ç”»ç“¢å°±å¥½ã€‚é¦–å…ˆåœ¨testsæ–‡ä»¶å¤¹ä¸‹æœ‰ä¸€ä¸ªpy.testä½¿ç”¨çš„conftest.pyæ–‡ä»¶ï¼ˆæ¨èä½ ä½¿ç”¨pyteståšæµ‹è¯•ï¼Œç›¸å½“ä¾¿æ·ï¼‰</p>
<pre><code># -*- coding: utf-8 -*-
&quot;&quot;&quot;Defines fixtures available to all tests.
http://doc.pytest.org/en/latest/fixture.html?highlight=fixture
&quot;&quot;&quot;

import pytest
from webtest import TestApp

from crm_backend.app import create_app
from crm_backend.database import db as _db
from crm_backend.settings import TestConfig

from .factories import UserFactory


@pytest.yield_fixture(scope=&apos;function&apos;)
def app():
    &quot;&quot;&quot;An application for the tests.&quot;&quot;&quot;
    _app = create_app(TestConfig)
    ctx = _app.test_request_context()
    ctx.push()

    yield _app

    ctx.pop()


@pytest.yield_fixture
def client(app):
    &quot;&quot;&quot;A Flask test client. An instance of :class:`flask.testing.TestClient`
    by default.
    &quot;&quot;&quot;
    with app.test_client() as client:
        yield client


@pytest.fixture(scope=&apos;function&apos;)
def testapp(app):
    &quot;&quot;&quot;A Webtest app.&quot;&quot;&quot;
    return TestApp(app)


@pytest.yield_fixture(scope=&apos;function&apos;)
def db(app):
    &quot;&quot;&quot;A database for the tests.&quot;&quot;&quot;
    _db.app = app
    with app.app_context():
        _db.create_all()

    yield _db

    # Explicitly close DB connection
    _db.session.close()
    _db.drop_all()


@pytest.fixture
def user(db):
    &quot;&quot;&quot;A user for the tests.&quot;&quot;&quot;
    user = UserFactory(password=&apos;myprecious&apos;)
    db.session.commit()
    return user
</code></pre><p>å¯¹äºæ™®é€šçš„pythonå‡½æ•°æˆ–è€…ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç®€å•çš„testå‡½æ•°ï¼Œç”±äºç¼–å†™çš„æ˜¯webé¡¹ç›®ï¼Œéº»çƒ¦çš„åœ°æ–¹å°±åœ¨äºå’Œæ•°æ®åº“ä»¥åŠåç«¯è¯·æ±‚çš„äº¤äº’ã€‚åœ¨cookiecutterä¸­ä½¿ç”¨äº†pytestçš„fixtureç‰¹æ€§æ¥å¤„ç†å’Œæ•°æ®åº“çš„äº¤äº’é—®é¢˜ï¼Œä½¿ç”¨äº†webteståº“æ¥å¤„ç†è¯·æ±‚é—®é¢˜ã€‚åˆ†åˆ«æ¥çœ‹çœ‹å¦‚ä½•æµ‹è¯•Modelå’ŒViewå±‚ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨äº†flask restfulï¼Œæ‰€ä»¥æ”¹æˆäº†apiå±‚ã€‚</p>
<hr>
<h2 id="ä½¿ç”¨py-testæµ‹è¯•Modelå±‚"><a href="#ä½¿ç”¨py-testæµ‹è¯•Modelå±‚" class="headerlink" title="ä½¿ç”¨py.testæµ‹è¯•Modelå±‚"></a>ä½¿ç”¨py.testæµ‹è¯•Modelå±‚</h2><p>ä¸‹è¾¹æ˜¯cookiecutter-flaskè‡ªåŠ¨ç”Ÿæˆçš„å…³äºuserçš„Modelå•å…ƒæµ‹è¯•ã€‚è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œæµ‹è¯•ç±»TestUserä½¿ç”¨äº†fixture dbï¼Œè¿™ä¸ªfixtureåœ¨conftest.pyä¸­å®šä¹‰çš„ï¼Œä½¿ç”¨çš„æµ‹è¯•é…ç½® SQLALCHEMY_DATABASE_URI = â€˜sqlite:///:memory:â€™ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œdbä½¿ç”¨è¿™ä¸ªæ¨¡æ‹Ÿçš„sqlliteå†…å­˜æ•°æ®åº“ã€‚å…¶ä»–è²Œä¼¼ä¹Ÿæ²¡å•¥å¥½è¯´çš„äº†ï¼Œéƒ½æ˜¯åŸºæœ¬çš„crudæ“ä½œï¼Œç…§ç€å†™æµ‹è¯•å°±è¡Œï¼Œæ²¡å•¥å¥½è¯´çš„ï¼š</p>
<pre><code># -*- coding: utf-8 -*-
&quot;&quot;&quot;Model unit tests.&quot;&quot;&quot;
import datetime as dt
import pytest
from crm_backend.user.models import Role, User
from .factories import UserFactory


@pytest.mark.usefixtures(&apos;db&apos;)
class TestUser:
    &quot;&quot;&quot;User tests.&quot;&quot;&quot;

    def test_get_by_id(self):
        &quot;&quot;&quot;Get user by ID.&quot;&quot;&quot;
        user = User(&apos;foo&apos;, &apos;foo@bar.com&apos;)
        user.save()

        retrieved = User.get_by_id(user.id)
        assert retrieved == user

    def test_created_at_defaults_to_datetime(self):
        &quot;&quot;&quot;Test creation date.&quot;&quot;&quot;
        user = User(username=&apos;foo&apos;, email=&apos;foo@bar.com&apos;)
        user.save()
        assert bool(user.created_at)
        assert isinstance(user.created_at, dt.datetime)
</code></pre><hr>
<h2 id="æµ‹è¯•flaskæ¥å£"><a href="#æµ‹è¯•flaskæ¥å£" class="headerlink" title="æµ‹è¯•flaskæ¥å£"></a>æµ‹è¯•flaskæ¥å£</h2><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯<a href="http://docs.pylonsproject.org/projects/webtest/en/latest/" target="_blank" rel="noopener">WebTest</a>è¿™ä¸ªåº“è¿›è¡Œæµ‹è¯•ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨flaskè‡ªå¸¦çš„test_clientï¼ŒWebTestè¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ï¼Œå¸¸è§çš„ä¹Ÿå°±æ˜¯getã€postã€putæ–¹æ³•å’Œè¯·æ±‚æ•°æ®çš„æäº¤ï¼Œä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä»£ç è§ç¤ºä¾‹:</p>
<pre><code># -*- coding: utf-8 -*-

&quot;&quot;&quot;
flask flask_restful apiçš„å•å…ƒæµ‹è¯•
&quot;&quot;&quot;

import pytest
from crm_backend.extensions import api
from crm_backend.advertiser.api import (
    AdvertiserListApi, AdvertiserApi,
    BusinessLeadListApi,
)
from crm_backend.advertiser.models import (
    Advertiser,
)
from crm_backend.employee.models import (
    Employee,
)


@pytest.mark.usefixtures(&apos;db&apos;)
class TestAdvertiserListApi:

    def test_get(self, testapp):
        self.test_post(testapp)    # å…ˆåˆ›å»ºä¸€ä¸ªadvertiser
        url = api.url_for(AdvertiserListApi)
        res = testapp.get(
            url,
            {
                # &apos;fields&apos;: &quot;id,name&quot;,
                # &apos;filter&apos;: &quot;&quot;&quot;[{&quot;field&quot;:&quot;status&quot;,&quot;op&quot;:&quot;eq&quot;,&quot;q&quot;:1}]&quot;&quot;&quot;,
                &apos;limit&apos;: 1000,
                # &apos;order&apos;: &quot;&quot;,
                &apos;page&apos;: 1
            },
            expect_errors=True
        )
        assert len(res.json[&apos;data&apos;][&apos;items&apos;]) == 1

    def test_post(self, testapp):
        url = api.url_for(AdvertiserListApi)
        bd = Employee.create(
            name=&apos;e1&apos;, email=&apos;e1@bar.com&apos;, password=&apos;foobarbaz123&apos;,
            team=Employee.TeamEnum.__dict__[&apos;CN-Beijing1&apos;],
            is_leader=True,   # set leader
            role=Employee.RoleEnum.BD
        )
        res = testapp.post_json(
            url,
            {
                &apos;name&apos;: &apos;advertiser_wang&apos;,
                &apos;contact_name&apos;: &apos;xiaoliu&apos;,
                &apos;phone&apos;: &apos;18818881888&apos;,
                &apos;email&apos;: &apos;tes@qq.com&apos;,
            },
            expect_errors=True
        )
        a = Advertiser.get_by_id(1)
        assert res.json[&apos;data&apos;][&apos;id&apos;] == a.id
        assert a.name == &apos;advertiser_wang&apos;
        assert a.bd == bd
        assert a.is_client
        return a


@pytest.mark.usefixtures(&apos;db&apos;)
class TestAdvertiserApi:

    def test_get(self, testapp):
        a = Advertiser.create(name=&apos;adervertiser_wang&apos;)
        url = api.url_for(AdvertiserApi, advertiser_id=a.id)
        res = testapp.get(url)
        assert res.json[&apos;id&apos;] == str(a.id)

    def test_put(self, testapp):
        a = TestAdvertiserListApi().test_post(testapp)   # å…ˆåˆ›å»ºä¸ªç”¨æˆ·å†æ›´æ–°
        url = api.url_for(AdvertiserApi, advertiser_id=a.id)
        res = testapp.put_json(
            url,
            {
                &apos;name&apos;: &apos;new_advertiser_wang&apos;,
                &apos;contact_name&apos;: &apos;xiaoliu&apos;,
                &apos;phone&apos;: &apos;18818881888&apos;,
                &apos;email&apos;: &apos;tes@qq.com&apos;,
            },
            expect_errors=True
        )
        # æµ‹è¯•åç§°å·²ç»æ›´æ–°
        assert Advertiser.get_by_id(a.id).name == &apos;new_advertiser_wang&apos;
</code></pre><hr>
<h2 id="ä½¿ç”¨marshmallow-Schema-åºåˆ—åŒ–è¿”å›æ•°æ®"><a href="#ä½¿ç”¨marshmallow-Schema-åºåˆ—åŒ–è¿”å›æ•°æ®" class="headerlink" title="ä½¿ç”¨marshmallow.Schema åºåˆ—åŒ–è¿”å›æ•°æ®"></a>ä½¿ç”¨marshmallow.Schema åºåˆ—åŒ–è¿”å›æ•°æ®</h2><blockquote>
<p>marshmallow is an ORM/ODM/framework-agnostic library for converting complex datatypes, such as objects, to and from native Python datatypes.</p>
</blockquote>
<p>é˜…è¯»flask restfulæ–‡æ¡£çš„æ—¶å€™å‘ç°æåˆ°äº†è¿™ä¹ˆä¸ª<a href="https://marshmallow.readthedocs.io/" target="_blank" rel="noopener">marshmallow</a>ä¸œè¥¿æˆ‘å°±ç›´æ¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº†ã€‚<br>åœ¨åšåå°æ¥å£æ—¶ï¼Œä¸€èˆ¬ä¼šç¢°åˆ°ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªå°±æ˜¯å‚æ•°ï¼ˆè¡¨å•ï¼‰éªŒè¯ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯æ•°æ®è¿”å›ã€‚å‚æ•°æˆ–è€…è¡¨å•éªŒè¯éƒ½å¯ä»¥ç”¨wtformså®Œæˆï¼Œæˆ–è€…å¯ä»¥å°è¯•flask eveä½œè€…å†™çš„çœ‹é—¨ç‹— <a href="http://python-cerberus.org/" target="_blank" rel="noopener">Cerberus</a>ï¼Œè¿™ä¸ªCerberusæ˜¯ä¸“é—¨ç”¨æ¥æå­—æ®µæ ¡éªŒçš„ï¼Œä¸æ¶‰åŠè¡¨å•ã€‚æ•°æ®è¿”å›å¯èƒ½ä¸åŒé¡¹ç›®æœ‰ä¸åŒçš„åšæ³•ã€‚</p>
<p>marshmallowçš„ä½œç”¨å°±æ˜¯ç”¨æ¥åºåˆ—åŒ–è‡ªå®šä¹‰çš„ä¸€äº›Pythonç±»å®ä¾‹ã€‚æ¯”å¦‚æˆ‘ä»¬ä»æ•°æ®åº“ç”¨sqlalchemyæŸ¥åˆ°ä¸€ä¸ªå¯¹è±¡åˆ—è¡¨ä»¥åï¼Œéœ€è¦æŒ‰ç…§æŒ‡å®šæ ¼å¼è¿”å›å‰ç«¯éœ€è¦çš„æ•°æ®å’Œç±»å‹ï¼Œä¹‹å‰çš„åšæ³•éƒ½æ˜¯è‡ªå·±ç”¨å‡½æ•°è½¬æˆä¸ªdictï¼Œç°åœ¨è¿™ç§æ¨¡å¼åŒ–çš„ä¸œè¥¿å¯ä»¥ç›´æ¥ä½¿ç”¨marshmalowé‡Œçš„Schemaæ¥åšï¼Œè€Œä¸”éå¸¸çµæ´»ï¼Œéœ€è¦è¿”å›ä¸åŒæ ¼å¼æˆ–è€…ç±»å‹çš„æ•°æ®ç›´æ¥å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªschemaè§£å†³ã€‚ç»™ä¸ªå®˜æ–¹æ–‡æ¡£çš„ä¾‹å­:</p>
<pre><code>from datetime import date
from marshmallow import Schema, fields, pprint

class ArtistSchema(Schema):
    name = fields.Str()

class AlbumSchema(Schema):
    title = fields.Str()
    release_date = fields.Date()
    artist = fields.Nested(ArtistSchema())

bowie = dict(name=&apos;David Bowie&apos;)
album = dict(artist=bowie, title=&apos;Hunky Dory&apos;, release_date=date(1971, 12, 17))

schema = AlbumSchema()
result = schema.dump(album)
pprint(result.data, indent=2)
# { &apos;artist&apos;: {&apos;name&apos;: &apos;David Bowie&apos;},
#   &apos;release_date&apos;: &apos;1971-12-17&apos;,
#   &apos;title&apos;: &apos;Hunky Dory&apos;}
</code></pre><p>å®é™…ä¸Šæˆ‘æ„Ÿè§‰å’Œæœ€è¿‘æ¯”è¾ƒç«çš„<a href="http://graphql.org/learn/" target="_blank" rel="noopener">graphql</a>æœ‰ç‚¹åƒï¼Œé€šè¿‡å®šä¹‰ä¸€ç³»åˆ—æŸ¥è¯¢æ¨¡å¼ç›´æ¥è¿”å›æ•°æ®ã€‚è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨è‡ªå·±è½¬æˆdictäº†ï¼Œä¸ç›´è§‚ä¹Ÿä¸å¤Ÿé€šç”¨ã€‚ä½¿ç”¨è¿™ç§Schemaä»¥åä½ å°±å¯ä»¥å†™ä¸ªç»Ÿä¸€çš„æŸ¥è¯¢å‡½æ•°äº†ï¼Œéœ€è¦ä¸åŒçš„æ•°æ®æ ¼å¼åªè¦æŠŠSchemaç±»ä½œä¸ºå‚æ•°ä¼ ç»™å‡½æ•°å°±å¥½ï¼Œæˆ‘ç”šè‡³å°è¯•ç”¨ä¸€ä¸ªç»Ÿä¸€çš„åˆ†é¡µæŸ¥è¯¢å‡½æ•°è§£å†³äº†æ‰€æœ‰Modelçš„åˆ†é¡µæŸ¥è¯¢å’Œè¿‡æ»¤é—®é¢˜ã€‚</p>
<hr>
<h2 id="sqlalchemyä½¿ç”¨çš„ä¸€äº›æ³¨æ„äº‹é¡¹"><a href="#sqlalchemyä½¿ç”¨çš„ä¸€äº›æ³¨æ„äº‹é¡¹" class="headerlink" title="sqlalchemyä½¿ç”¨çš„ä¸€äº›æ³¨æ„äº‹é¡¹"></a>sqlalchemyä½¿ç”¨çš„ä¸€äº›æ³¨æ„äº‹é¡¹</h2><p>æ•°æ®åº“ä¸€ç›´æ˜¯æˆ‘çš„å¼±é¡¹ï¼Œè¿˜å¥½è¿™æ¬¡æ²¡ç¢°åˆ°å•¥å‘é—®é¢˜ã€‚</p>
<ul>
<li>æ¶‰åŠä¸åŒæ—¶åŒºçš„æ—¶å€™ç»Ÿä¸€å­˜å‚¨utcæ—¶é—´ï¼Œç„¶åæ ¹æ®ä¸åŒæ—¶åŒºè½¬åŒ–ã€‚å¯ä»¥çœ‹ä¸‹flask_babelæ¨¡å—ï¼Œç”¨æ¥å¤„ç†å›½é™…åŒ–é—®é¢˜çš„ã€‚</li>
<li>æ¶‰åŠåˆ°é‡‘é’±ç›¸å…³çš„æ•°æ®æœ€å¥½ç”¨decimalå¤„ç†ï¼Œä¸è¦ç”¨floaté€ æˆç²¾åº¦æŸå¤±ã€‚</li>
<li>æœ€å¥½ç›´æ¥ä½¿ç”¨dateå’Œdatetimeç±»å‹ï¼Œä¸è¦å­˜å‚¨å­—ç¬¦ä¸²æ—¥æœŸã€‚</li>
<li>å»ºå­—æ®µçš„æ—¶å€™è€ƒè™‘ä¸‹db.Columnçš„å‚æ•°default, index, nullable, primary_key, uniqueå“ªäº›çº¦æŸä¼šç”¨å¾—ä¸Šã€‚</li>
<li>ä½¿ç”¨ä¸ä½¿ç”¨å¤–é”®ï¼Ÿæˆ‘çœ‹é˜¿é‡Œçš„javaè§„èŒƒä¸­ä¸å…è®¸ä½¿ç”¨å¤–é”®ä¸çº§è”ï¼Œå¤–é”®å’Œçº§è”æ›´æ–°åªé€‚åˆå•æœºä½å¹¶å‘ï¼Œä¸é€‚åˆåˆ†å¸ƒå¼ã€é«˜å¹¶å‘é›†ç¾¤ã€‚æˆ‘æœäº†ä¸‹ç½‘ä¸Šçš„ä¿¡æ¯ï¼Œå‘ç°äº‰è®ºè¿˜æ˜¯å¾ˆå¤šçš„ã€‚æˆ‘è§‰å¾—åšå†…éƒ¨ç³»ç»Ÿåƒæ˜¯erpæˆ–è€…crmç­‰åº”ç”¨è¿˜æ˜¯ç”¨å¤–é”®æ¯”è¾ƒå¥½ã€‚</li>
<li>åˆ›å»ºæ•°æ®åº“ä½¿ç”¨utf8ï¼Œ<code>CREATE DATABASE IF NOT EXISTS my_db default charset utf8 COLLATE utf8_general_ci;</code></li>
<li>è¿æ¥urlä½¿ç”¨<code>mysql://root:root@127.0.0.1:3306/my_db?charset=utf8</code>ã€‚ä¸ç”¨æ‹…å¿ƒä¹±ç é—®é¢˜äº†</li>
</ul>
<hr>
<h2 id="å¢å¼ºflask-sqlalchemyè‡ªå¸¦çš„Modelç±»"><a href="#å¢å¼ºflask-sqlalchemyè‡ªå¸¦çš„Modelç±»" class="headerlink" title="å¢å¼ºflask_sqlalchemyè‡ªå¸¦çš„Modelç±»"></a>å¢å¼ºflask_sqlalchemyè‡ªå¸¦çš„Modelç±»</h2><p>cookiecutter-flaskç”Ÿæˆçš„æ¡†æ¶é‡Œè¾¹è‡ªå¸¦äº†ä¸€ä¸ªCRUDMixinç±»ï¼Œç”¨æ¥ç»™Modelå¢åŠ å¸¸ç”¨çš„å¢åˆ æ”¹æŸ¥ï¼Œæˆ‘ç¨å¾®åŠ äº†å‡ ä¸ªå‡½æ•°ç”¨æ¥è§£å†³ä¸€äº›é€šç”¨çš„æŸ¥è¯¢ã€‚æ¯”å¦‚æˆ‘çš„query_paginate_and_dumpä¸€ä¸ªå‡½æ•°è§£å†³äº†å‡ ä¹å¤§éƒ¨åˆ†çš„æŸ¥è¯¢é—®é¢˜ã€‚(å€Ÿé‰´äº†ä»–äººçš„ä¸€äº›ä»£ç ï¼‰</p>
<pre><code># -*- coding: utf-8 -*-

&quot;&quot;&quot;Database module, including the SQLAlchemy database object and DB-related
utilities.&quot;&quot;&quot;

import datetime as dt
from pprint import pformat
from marshmallow import Schema
from sqlalchemy import desc, or_
from sqlalchemy.sql.sqltypes import Date, DateTime
from sqlalchemy.orm import relationship
from werkzeug import cached_property

from .compat import basestring
from .extensions import db
from .utils import date_str_to_obj, datetime_str_to_obj

# Alias common SQLAlchemy names
Column = db.Column
relationship = relationship


OPERATOR_FUNC_DICT = {
    &apos;=&apos;: (lambda cls, k, v: getattr(cls, k) == v),
    &apos;==&apos;: (lambda cls, k, v: getattr(cls, k) == v),
    &apos;eq&apos;: (lambda cls, k, v: getattr(cls, k) == v),
    &apos;!=&apos;: (lambda cls, k, v: getattr(cls, k) != v),
    &apos;ne&apos;: (lambda cls, k, v: getattr(cls, k) != v),
    &apos;neq&apos;: (lambda cls, k, v: getattr(cls, k) != v),
    &apos;&gt;&apos;: (lambda cls, k, v: getattr(cls, k) &gt; v),
    &apos;gt&apos;: (lambda cls, k, v: getattr(cls, k) &gt; v),
    &apos;&gt;=&apos;: (lambda cls, k, v: getattr(cls, k) &gt;= v),
    &apos;gte&apos;: (lambda cls, k, v: getattr(cls, k) &gt;= v),
    &apos;&lt;&apos;: (lambda cls, k, v: getattr(cls, k) &lt; v),
    &apos;lt&apos;: (lambda cls, k, v: getattr(cls, k) &lt; v),
    &apos;&lt;=&apos;: (lambda cls, k, v: getattr(cls, k) &lt;= v),
    &apos;lte&apos;: (lambda cls, k, v: getattr(cls, k) &lt;= v),
    &apos;or&apos;: (lambda cls, k, v: or_(getattr(cls, k) == value for value in v)),
    &apos;in&apos;: (lambda cls, k, v: getattr(cls, k).in_(v)),
    &apos;nin&apos;: (lambda cls, k, v: ~getattr(cls, k).in_(v)),
    &apos;like&apos;: (lambda cls, k, v: getattr(cls, k).like(&apos;%{}%&apos;.format(v))),
    &apos;nlike&apos;: (lambda cls, k, v: ~getattr(cls, k).like(v)),
    &apos;+&apos;: (lambda cls, k, v: getattr(cls, k) + v),
    &apos;incr&apos;: (lambda cls, k, v: getattr(cls, k) + v),
    &apos;-&apos;: (lambda cls, k, v: getattr(cls, k) - v),
    &apos;decr&apos;: (lambda cls, k, v: getattr(cls, k) - v),
}


def parse_operator(cls, filter_name_dict):
    &quot;&quot;&quot; ç”¨æ¥è¿”å›sqlalchemy queryå¯¹è±¡filterä½¿ç”¨çš„è¡¨è¾¾å¼
    Args:
        filter_name_dict (dict): è¿‡æ»¤æ¡ä»¶dict
        {
            &apos;last_name&apos;: {&apos;eq&apos;: &apos;wang&apos;},    # å¦‚æœæ˜¯dicä½¿ç”¨keyä½œä¸ºæ“ä½œç¬¦
            &apos;age&apos;: {&apos;&gt;&apos;: 12}
        }
    Returns:
        binary_expression_list (lambda list)
    &quot;&quot;&quot;
    def _change_type(cls, field, value):
        &quot;&quot;&quot; æœ‰äº›è¡¨å­—æ®µæ¯”å¦‚DateTimeç±»å‹æ¯”è¾ƒçš„æ—¶å€™éœ€è¦è½¬æ¢ç±»å‹ï¼Œ
        å‰ç«¯ä¼ è¿‡æ¥çš„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼ŒDateç­‰ç±»å‹æ²¡æ³•ç›´æ¥ç›¸æ¯”è¾ƒï¼Œéœ€è¦è½¬æˆDateç±»å‹
        Args:
            cls (class): Model class
            field (str): Model class field
            value (str): value need to compare
        &quot;&quot;&quot;
        field_type = getattr(cls, field).type
        if isinstance(field_type, Date):
            return date_str_to_obj(value)
        elif isinstance(field_type, DateTime):
            return datetime_str_to_obj(value)
        else:
            return value

    binary_expression_list = []
    for field, op_dict in filter_name_dict.items():
        for op, op_val in op_dict.items():
            op_val = _change_type(cls, field, op_val)
            if op in OPERATOR_FUNC_DICT:
                binary_expression_list.append(
                    OPERATOR_FUNC_DICT[op](cls, field, op_val)
                )
    return binary_expression_list


class CRUDMixin(object):
    &quot;&quot;&quot;Mixin that adds convenience methods for
    CRUD (create, read, update, delete) operations.&quot;&quot;&quot;

    @classmethod
    def create(cls, **kwargs):
        &quot;&quot;&quot;Create a new record and save it the database.&quot;&quot;&quot;
        instance = cls(**kwargs)
        return instance.save()

    @classmethod
    def create_from_dict(cls, d):
        &quot;&quot;&quot;Create a new record and save it the database.&quot;&quot;&quot;
        assert isinstance(d, dict)
        instance = cls(**d)
        return instance.save()

    def update(self, commit=True, **kwargs):
        &quot;&quot;&quot;Update specific fields of a record.&quot;&quot;&quot;
        for attr, value in kwargs.items():
            setattr(self, attr, value)
        return commit and self.save() or self

    def save(self, commit=True):
        &quot;&quot;&quot;Save the record.&quot;&quot;&quot;
        db.session.add(self)
        if commit:
            db.session.commit()
        return self

    def delete(self, commit=True):
        &quot;&quot;&quot;Remove the record from the database.&quot;&quot;&quot;
        db.session.delete(self)
        return commit and db.session.commit()

    def to_dict(self, fields_list=None):
        &quot;&quot;&quot;
        Args:
            fields (str list): æŒ‡å®šè¿”å›çš„å­—æ®µ
        &quot;&quot;&quot;
        column_list = fields_list or [
            column.name for column in self.__table__.columns
        ]
        return {
            column_name: getattr(self, column_name)
            for column_name in column_list
        }

    @classmethod
    def create_or_update(cls, query_dict, update_dict=None):
        instance = db.session.query(cls).filter_by(**query_dict).first()
        if instance:  # update
            if update_dict is not None:
                return instance.update(**update_dict)
            else:
                return instance
        else:    # create new instance
            query_dict.update(update_dict or {})
            return cls.create(**query_dict)

    @classmethod
    def query_paginate(cls, page=1, limit=20, fields=None, order_by_list=None,
                    filter_name_dict=None):
        &quot;&quot;&quot; é€šç”¨çš„åˆ†é¡µæŸ¥è¯¢å‡½æ•°
        Args:
            page (int): é¡µæ•°
            limit (int): æ¯é¡µä¸ªæ•°
            order_by_list (tuple list): ç”¨æ¥æŒ‡å®šæ’åºçš„å­—æ®µï¼Œå¯ä»¥ä¼ å¤šä¸ª
                [ (&apos;id&apos;, 1), (&apos;name&apos;, -1) ]ï¼Œ1è¡¨ç¤ºæ­£åºï¼Œ-1è¡¨ç¤ºé€†åº
                or
                [ (&apos;id&apos;, &apos;asc&apos;), (&apos;name&apos;, &apos;desc&apos;) ]ï¼Œ1è¡¨ç¤ºæ­£åºï¼Œ-1è¡¨ç¤ºé€†åº

            filter_name_dict (dict): è¿‡æ»¤æ¡ä»¶ï¼Œä½¿ç”¨å­—å…¸è¡¨ç¤ºï¼Œä½¿ç”¨å­—æ®µåä½œä¸ºkeyï¼Œvalue
                æ˜¯{&apos;operator&apos;: to_compare_value}, e.g.:
                {
                    &apos;last_name&apos;: {&apos;eq&apos;: &apos;wang&apos;},  # å¦‚æœæ˜¯dicä½¿ç”¨keyä½œä¸ºæ“ä½œç¬¦
                    &apos;age&apos;: {&apos;&gt;&apos;: 12}
                }

        Returns:
            if fields is not None:
                (keytuple_list, total_cnt) (tuple)
            else:
                (instance_list, total_cnt) (tuple)

        å‰æ®µæŸ¥è¯¢å‚æ•°è§„èŒƒï¼š
        request.args ç¤ºä¾‹ï¼š
        ImmutableMultiDict([(&apos;limit&apos;, &apos;10&apos;), (&apos;page&apos;, &apos;1&apos;), (&apos;filter&apos;, &apos;[{&quot;field&quot;:&quot;name&quot;,&quot;op&quot;:&quot;eq&quot;,&quot;q&quot;:&quot;g&quot;},{
        &quot;field&quot;:&quot;id&quot;,&quot;op&quot;:&quot;gt&quot;,&quot;q&quot;:&quot;5&quot;
        }]&apos;)])

        page: é¡µç 
        limit: æ¯é¡µé™åˆ¶
        order: é¡ºåºï¼Œå–å€¼&quot;asc&quot; &quot;desc&quot;. &quot;&quot;&quot;&apos;name&apos;, &apos;asc&apos;, &apos;model&apos;,&apos;desc&apos;&quot;&quot;&quot;
        fields: éœ€è¦è¿”å›çš„å­—æ®µ
        filter: è¿‡æ»¤æ¡ä»¶ï¼š
        {
            field: éœ€è¦è¿‡æ»¤çš„å­—æ®µ
            op: è¿‡æ»¤æ“ä½œç¬¦,æ”¯æŒ&quot;eq&quot;,&quot;neq&quot;,&quot;gt&quot;,&quot;gte&quot;,&quot;lt&quot;,&quot;lte&quot;,&quot;in&quot;,&quot;nin&quot;,&quot;like&quot;
            q: è¿‡æ»¤å€¼
        }
        &quot;&quot;&quot;
        fields = (
            [getattr(cls, column) for column in fields] if fields is not None
            else None
        )
        if fields:
            query = db.session.query(*fields)
        else:
            query = db.session.query(cls)
        if order_by_list:
            for (field, order) in order_by_list:
                query = (
                    query.order_by(getattr(cls, field)) if order == 1 else
                    query.order_by(desc(getattr(cls, field)))
                )

        if filter_name_dict:
            p = parse_operator(cls, filter_name_dict)
            query = query.filter(*p)

        total_cnt = query.count()
        start = (page-1) * limit
        query = query.offset(start).limit(limit)
        instance_or_keytuple_list = query.all()
        return instance_or_keytuple_list, total_cnt

    @classmethod
    def dump_schema(cls, items, fields, schema_class):
        &quot;&quot;&quot; ç”¨æ¥åºåˆ—åŒ–ä»æ•°æ®åº“æŸ¥è¯¢å‡ºæ¥çš„å¯¹è±¡
        Args:
            items (instance list): obj list query from mysql
            fields (str list): fields need to dump
            schema_class (marshmallow.Schema): marshmallow.Schema class
        Returns:
            items, err
        &quot;&quot;&quot;
        fields = (
            fields if fields else list(schema_class._declared_fields.keys())
        )
        schema = schema_class(many=True, only=fields)
        items, err = schema.dump(items)
        return items, err

    @classmethod
    def query_paginate_and_dump_schema(cls, page=1, limit=20, fields=None,
                                    order_by_list=None,
                                    filter_name_dict=None,
                                    schema_class=None):
        &quot;&quot;&quot; åˆ†é¡µæŸ¥è¯¢å¹¶ä¸”è¿”å›dumpåçš„å¯¹è±¡ï¼Œå¯ä»¥è§£å†³å¤§éƒ¨åˆ†æŸ¥è¯¢é—®é¢˜ &quot;&quot;&quot;
        assert schema_class
        items, total_cnt = cls.query_paginate(
            page, limit, fields, order_by_list, filter_name_dict
        )
        items, err = cls.dump_schema(items, fields, schema_class)
        return items, total_cnt

    def __repr__(self):
        return pformat(self.to_dict())

    @cached_property
    def column_name_set(self):
        return set([column.name for column in self.__table__.columns])

    @classmethod
    def get_common_fields(cls, fields=None):
        &quot;&quot;&quot; é˜²æ­¢ä¼ è¿‡æ¥çš„fieldså«æœ‰è¯¥Modelæ²¡æœ‰çš„å­—æ®µ &quot;&quot;&quot;
        if not fields:
            return []
        table_fields_set = set(
            [column.name for column in cls.__table__.columns]
        )
        return list(table_fields_set &amp; set(fields))


class Model(CRUDMixin, db.Model):
    &quot;&quot;&quot;Base model class that includes CRUD convenience methods.&quot;&quot;&quot;

    __abstract__ = True
</code></pre><p>æš‚æ—¶å°±æ›´æ–°è¿™ä¹ˆå¤šå§ï¼Œflaskç”¨å¾—ä¸å¤šï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›å‘è¦è¸©ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚</p>
<hr>
<h2 id="æ‘¸ç´¢ä¸æ€»ç»“ï¼š"><a href="#æ‘¸ç´¢ä¸æ€»ç»“ï¼š" class="headerlink" title="æ‘¸ç´¢ä¸æ€»ç»“ï¼š"></a>æ‘¸ç´¢ä¸æ€»ç»“ï¼š</h2><ol start="0">
<li>ä¸è¦å› ä¸ºè¿›åº¦ç´§è€Œè¿èƒŒåŸåˆ™ï¼Œä½ å¯èƒ½æ°¸è¿œæ— æ³•è¡¡é‡è¿èƒŒåŸåˆ™æµªè´¹çš„æ—¶é—´ï¼Œä¸€æ—¶å·æ‡’ä¼šä»˜å‡ºæ›´å¤šç»´æŠ¤ä»£ä»·ï¼Œå¾—ä¸å¿å¤±ã€‚</li>
<li>ä½¿ç”¨pytestçš„fixtureç‰¹æ€§å¤„ç†å’Œæ•°æ®åº“çš„äº¤äº’ã€‚</li>
<li>ä½¿ç”¨webtestè¿›è¡Œviewæˆ–è€…apiå±‚çš„æ¥å£è°ƒç”¨æµ‹è¯•ã€‚</li>
<li>å•å…ƒæµ‹è¯•ä»£ç ä¸è¦å¤æ‚ï¼Œä»¥å…åœ¨æµ‹è¯•ä¸­å¼•å…¥bugã€‚å¦‚æœè§‰å¾—éº»çƒ¦ï¼Œåº”è¯¥åœ¨ä½ è§‰å¾—å¿…è¦æ—¶å€™å†™å•å…ƒæµ‹è¯•ã€‚</li>
<li>å•å…ƒæµ‹è¯•ä¸€å®šè¦æ˜“äºæ„é€ å’Œæ‰§è¡Œ(è¿™ä¸€ç‚¹æœ€æœ€é‡è¦)ã€‚å•å…ƒæµ‹è¯•åªåœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œåœ¨è¿™é‡Œæˆ‘çš„å•å…ƒæµ‹è¯•é…ç½®ä½¿ç”¨çš„æ˜¯sqlliteçš„memoryé…ç½®ï¼Œ SQLALCHEMY_DATABASE_URI = â€˜sqlite:///:memory:â€™ï¼Œ ç”šè‡³éƒ½æ²¡æœ‰ä½¿ç”¨è¿‡mysqlã€‚å¥½å¤„å°±æ˜¯åˆ°å“ªé‡Œéƒ½å¯ä»¥è¿è¡Œæµ‹è¯•ï¼Œä¸è¦ç»™æµ‹è¯•å¼•å…¥å¤æ‚æ€§ï¼Œå¹¶ä¸”æå‡äº†æµ‹è¯•é€Ÿåº¦ã€‚å’Œå‰ç«¯å¯¹æ¥çš„æ—¶å€™æµ‹è¯•æ•°æ®åº“ä½¿ç”¨å¦ä¸€å¥—é…ç½®ï¼Œä¸è¦å’Œå•å…ƒæµ‹è¯•æ··ç”¨ã€‚åªè¦éµå¾ªéœ€è¦æ—¶åˆ›å»ºï¼Œæµ‹è¯•å®Œåˆ é™¤å°±å®Œå…¨å¯ä»¥åšåˆ°åªåœ¨å†…å­˜ä¸­æ‰§è¡Œå•å…ƒæµ‹è¯•ã€‚å¦‚æœéœ€è¦ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼Œåœ¨TestClassé‡Œå†™ä¸€ä¸ªå‡½æ•°ä¸“é—¨ç”¨æ¥ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼Œæµ‹è¯•æ—¶å€™è°ƒç”¨ï¼Œè€Œä¸è¦ä½¿ç”¨çœŸå®çš„æ•°æ®åº“ç»™æ„é€ æµ‹è¯•å¸¦æ¥éº»çƒ¦ï¼Œå¦åˆ™å¯èƒ½ä¼šå¼•å…¥å¾ˆå¤šåƒåœ¾æµ‹è¯•æ•°æ®ï¼Œå¹¶ä¸”æ„å»ºå’Œè¿è¡Œå•å…ƒæµ‹è¯•å˜å¾—å›°éš¾.</li>
<li>å¯ä»¥ä½¿ç”¨fswatchç­‰å‘½ä»¤å·¥å…·ç›‘æ§æ–‡ä»¶å˜åŠ¨ï¼Œæ¯æ¬¡æ›´æ”¹éƒ½ä¼šè§¦å‘é‡è·‘ç›¸å…³æµ‹è¯•ï¼Œä¿è¯ä¸ä¼šæ”¹å‡ºé—®é¢˜ã€‚æˆ‘ç°åœ¨å†™ä»£ç å°±æ˜¯å¼€äº†å¤šçª—å£ï¼Œæ¯æ¬¡æ”¹åŠ¨æˆ‘éƒ½ä¼šçœ‹å³è¾¹æµ‹è¯•æ˜¯å¦æœ‰çº¢è‰²çš„Failedçš„ç»“æœã€‚æ–¹ä¾¿æˆ‘å¿«é€Ÿé‡æ„ï¼Œæ•ˆæœè¿˜æ˜¯æŒºèµçš„ã€‚ç›¸å½“äºæœ¬åœ°çš„æŒç»­é›†æˆã€‚</li>
<li>æ–°é¡¹ç›®å¯ä»¥ç›´æ¥ä½¿ç”¨cookiecutter-flaskç”Ÿæˆæ¡†æ¶ï¼Œä½ åªéœ€è¦å¿«é€Ÿå¡«å†™ä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€è¿‡åº¦å…³å¿ƒä»£ç ç»“æ„ç»„ç»‡ã€‚</li>
<li>å¤„ç†è¿”å›æ•°æ®å¯ä»¥ä½¿ç”¨marshmallow.Schemaè§£å†³ï¼Œæ›´åŠ çµæ´»é€šç”¨ã€ç›´è§‚ã€‚ç”šè‡³ä¸ç”¨å†™è¿”å›å€¼æ–‡æ¡£ï¼Œç›´æ¥çœ‹Schemaç»“æ„å°±è¡Œã€‚é™¤éä½ å¯¹é€Ÿåº¦æœ‰å˜æ€è¦æ±‚ï¼Œå¢åŠ ä¸€å±‚æŠ½è±¡ä¼šæŸå¤±éƒ¨åˆ†æ€§èƒ½ã€‚å¦‚æœåºåˆ—åŒ–æœ‰æ€§èƒ½ç“¶é¢ˆï¼Œå¯ä»¥å°è¯•ä¸‹ujsonï¼Œæˆ‘çœ‹åˆ°å¾ˆå¤šbenchmarkç»“æœujsonéƒ½æ˜¯æœ€å¿«çš„ã€‚</li>
<li>å†™æµ‹è¯•ä¸æ˜¯èµ°èµ°æµç¨‹å’Œå½¢å¼ï¼Œè€Œæ˜¯è®©ä½ æ”¹å˜â€å†™ä¸€ç‚¹ä»£ç printçœ‹ç»“æœå°±è§‰å¾—OKäº†â€çš„ä¸è‰¯ç¼–ç ä¹ æƒ¯ã€‚è¿™ä¸€ç‚¹å¯¹äºå¤§å‹é¡¹ç›®è‡³å…³é‡è¦.æ­¥å­ä¸è¦è¿ˆå¤§äº†ï¼Œå†™ä¸€ä¸ªæµ‹ä¸€ä¸ªï¼Œé˜²æ­¢ç»„åˆèµ·æ¥ä»¥åéš¾ä»¥å®šä½é”™è¯¯ã€‚</li>
<li>å•å…ƒæµ‹è¯•é‡Œå°‘ç”¨ç”šè‡³ä¸è¦ç”¨printï¼Œä½ ä¸´æ—¶çœ‹çœ‹ç»“æœå¯ä»¥ç”¨ï¼Œæœ€å¥½å¤šä½¿ç”¨assertè¯­å¥ï¼ŒæŠŠä½ æœŸæœ›çš„ç»“æœç”¨assertè¯­å¥è¡¨ç¤ºå‡ºæ¥ï¼Œprintå¤šäº†ä¼šæ‰°ä¹±è¾“å‡ºï¼Œå½“æµ‹è¯•å‡½æ•°å¤šäº†çš„æ—¶å€™ä¼šç»™éªŒè¯ç»“æœä»£ç éº»çƒ¦ã€‚</li>
<li>å‡ºç°bugä¿®å¤åæŠŠå•å…ƒæµ‹è¯•ç”¨ä¾‹åŠ åˆ°åŸæœ‰ç”¨ä¾‹ä¸­ï¼Œé˜²æ­¢å†æ¬¡å‡ºé”™ã€‚(è¾“å…¥ç»„åˆï¼Œè¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸)</li>
<li>ä¸€å¼€å§‹å°±è¦ä¿è¯é¡¹ç›®è´¨é‡ï¼Œé˜²æ­¢ç§¯ç´¯æŠ€æœ¯å€ºåŠ¡ç»™ç»´æŠ¤å¸¦æ¥è´Ÿæ‹…ï¼ˆå•å…ƒæµ‹è¯•è®©æˆ‘å¯ä»¥æ”¾å¿ƒå¤§èƒ†åœ°å¿«é€Ÿé‡æ„ï¼‰</li>
<li>è­¦æƒ•éš¾ä»¥æµ‹è¯•çš„ä»£ç ï¼Œéš¾ä»¥æµ‹è¯•çš„ä»£ç å¾€å¾€éœ€è¦é‡æ„ã€‚</li>
</ol>
<p><img src="http://7ktuty.com1.z0.glb.clouddn.com/vim_tmux_tdd.gif" alt="vim+tmux+python+tdd"></p>
<p>æ€»å¾—æ¥è¯´ç”¨flaskå¼€å‘è¿˜æ˜¯ä¸€ä»¶æŒºæ„‰å¿«çš„äº‹æƒ…ï¼Œä¸°å¯Œçš„æ’ä»¶æ”¯æŒï¼Œcookiecutter-flaskä¹Ÿæ˜¯ä¸ªå¾ˆæ–¹ä¾¿çš„é¡¹ç›®ç”Ÿæˆæ¡†æ¶ï¼Œpandaså¯ä»¥å¾ˆæ–¹ä¾¿æ»´å¤„ç†æŠ¥è¡¨ï¼Œåšä¸œè¥¿è¿˜ç®—æ¯”è¾ƒå¿«ã€‚å¸Œæœ›æœ¬ç¯‡æ¶‰åŠåˆ°çš„ä¸€äº›ä¸œè¥¿å¯ä»¥è®©ä½ çš„å¼€å‘æ›´é«˜æ•ˆï¼Œå¦‚æœå¯¹ä»£ç æœ‰ä»€ä¹ˆå»ºè®®ä¹Ÿæ¬¢è¿æ²Ÿé€šğŸ˜„.å¦å¤–æœ‰ä¸ªæƒŠå–œå°±æ˜¯python3æ¯”æˆ‘æƒ³è±¡ä¸­æˆç†Ÿï¼Œ<a href="http://py3readiness.org/" target="_blank" rel="noopener">Python 3 Readiness</a>åˆ—å‡ºPyPIä¸Šæœ€å¸¸ç”¨çš„å·²ç»æ”¯æŒäº†python3çš„åº“ï¼Œå¦‚æœæ–°é¡¹ç›®æ²¡æœ‰å†å²åŒ…è¢±ï¼Œå®Œå…¨å¯ä»¥å°è¯•python3.5ï¼Œä¸‹è¾¹æ˜¯æˆ‘ä»¬é¡¹ç›®ä½¿ç”¨çš„ä¾èµ–ï¼Œéƒ½æ”¯æŒpython3äº†(python3.5ä½¿ç”¨æ²¡é—®é¢˜)ï¼Œæš‚æ—¶æ²¡æœ‰ç¢°åˆ°ä»»ä½•é—®é¢˜(è¯•æ°´æˆåŠŸä»¥åæ–°é¡¹ç›®éƒ½å¼€å§‹ç”¨py3)ã€‚åŒæ—¶ä¹Ÿå¯ä»¥å°è¯•ä¸‹python3.5çš„ç±»å‹æ³¨è§£ã€asyncioç­‰æ–°ç©æ„ã€‚</p>
<pre><code>Flask-Admin==1.4.2
Flask-Assets==0.12
Flask-Babel==0.11.1
Flask-Bcrypt==0.7.1
Flask-DebugToolbar==0.10.0
Flask-Login==0.3.2
Flask-Mail==0.9.1
Flask-Migrate==2.0.0
Flask-RESTful==0.3.5
Flask-Redis==0.3.0
Flask-SQLAlchemy==2.1
Flask-WTF==0.12
Flask==0.11.1
Jinja2==2.8
MarkupSafe==0.23
Pillow==3.4.2
SQLAlchemy==1.0.12
WTForms==2.1
WebTest==2.0.20
Werkzeug==0.11.4
boto3==1.4.1
coloredlogs==5.0
facebookads==2.8.1
factory-boy==2.6.1
flake8-blind-except==0.1.0
flake8-debugger==1.4.0
flake8-docstrings==0.2.5
flake8-isort==1.2
flake8-quotes==0.2.4
flake8==2.5.4
flask-shell-ipython==0.2.2
fluent-logger==0.4.4
google-api-python-client==1.6.1
googleads==4.6.1
ipdb==0.10.1
isort==4.2.2
itsdangerous==0.24
marshmallow==2.10.3
mockredispy==2.9.3
mysqlclient==1.3.9
openpyxl==2.4.1
pandas==0.18.1
pep8-naming==0.3.3
psycopg2==2.6.1
psycopg2==2.6.1
pytest==2.9.0
python-dateutil==2.4.2
raven==5.31.0
requests==2.10.0
unicodecsv==0.14.1
uwsgi==2.0.14
xlrd==1.0.0
</code></pre>
      
    </div>
    <footer>
      
          
          <div class="clearfix"></div>
          <nav id="pagination">
  
    <a href="/2016/12/10/python/data-structures-and-algorithms-using-python/" class="alignleft prev"><i class="fa fa-long-arrow-left"></i>Next</a>
  
  
    <a href="/2016/11/09/tools/vim-tmux-zsh-autojump/" class="alignright next">Prev<i class="fa fa-long-arrow-right"></i></a>
  
  <div class="clearfix"></div>
</nav>
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">ç•™è¨€</h1>

  
</section>



    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div>
  
  &copy; 2018 PegasusWang
  
</div>
Powered by <a href="http://zespia.tw/hexo/" title="Hexo" target="_blank" rel="noopener">Hexo</a> and <a href="http://pages.github.com/" title="GitHub Pages" target="_blank" rel="noopener">GitHub Pages</a>

<div class="clearfix"></div>


<!--
<span id="busuanzi_container_site_pv">
    æ‚¨æ˜¯ç¬¬<span id="busuanzi_value_site_pv"></span>æ¬¡è®¿é—®æ»´ç«¥é‹
</span>

<script async
src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
-->
</footer>
  
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>




    <script type="text/javascript">
        (function(){

            $(window).scroll(function(){

                var scrollTop = $(window).scrollTop();
                if ( scrollTop >200 ){
                    $("#main-nav").removeClass('normal_mode').addClass('top_mode');
                } else{
                    $("#main-nav").removeClass('top_mode').addClass('normal_mode');
                }

            });

        })();
    </script>



  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
  (function($){
    $('.fancybox').fancybox({
      'titlePosition': 'inside'
    });
  })(jQuery);
  </script>




<script type="text/javascript">
  
  $(function(){

    $('.title').hover(
      function() {      
        $(this).stop().animate(
          {'marginLeft': '10px'}, 200
        );   
      }, 
      function() {       
        $(this).stop().animate({'marginLeft': '0px'}, 200);      
      
    });   

  });

</script>


</body>
</html>